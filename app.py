import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from statsmodels.tsa.arima.model import ARIMA
from sklearn.metrics import mean_squared_error
from math import sqrt
from io import StringIO

# البيانات النصية التي قدمتها
data = """
Order_ID,Order_Date,Product_Category,Product_Name,Quantity,Price_Per_Unit,Total_Price,Customer_ID,Customer_City,Payment_Method,Shipping_Method,Discount_Applied
1,2024-07-01,ملابس,قميص,2,25,50,101,الرياض,بطاقة ائتمان,شحن سريع,False
2,2024-07-01,إلكترونيات,هاتف ذكي,1,800,800,102,جدة,PayPal,شحن عادي,False
3,2024-07-02,كتب,رواية,1,15,15,103,الدمام,دفع عند الاستلام,شحن سريع,False
4,2024-07-02,ملابس,بنطال,1,50,50,101,الرياض,PayPal,شحن عادي,True
5,2024-07-03,أثاث,كرسي,2,100,200,104,مكة,بطاقة ائتمان,شحن سريع,False
6,2024-07-03,إلكترونيات,سماعات,1,75,75,105,المدينة المنورة,دفع عند الاستلام,شحن عادي,False
7,2024-07-04,ملابس,حذاء,1,90,90,106,الرياض,PayPal,شحن سريع,True
8,2024-07-04,كتب,كتاب طبخ,2,20,40,103,الدمام,بطاقة ائتمان,شحن عادي,False
9,2024-07-05,أثاث,طاولة,1,150,150,107,جدة,دفع عند الاستلام,شحن سريع,False
10,2024-07-05,إلكترونيات,شاشة,1,300,300,108,مكة,PayPal,شحن عادي,False
11,2024-07-06,ملابس,قميص,1,25,25,109,الرياض,بطاقة ائتمان,شحن سريع,False
12,2024-07-06,كتب,ديوان شعر,3,10,30,104,مكة,دفع عند الاستلام,شحن عادي,True
13,2024-07-07,أثاث,سرير,1,500,500,110,المدينة المنورة,PayPal,شحن سريع,False
14,2024-07-07,إلكترونيات,ساعة ذكية,2,120,240,106,الرياض,بطاقة ائتمان,شحن عادي,False
15,2024-07-08,ملابس,بنطال,2,50,100,102,جدة,PayPal,شحن سريع,False
16,2024-07-08,كتب,موسوعة,1,40,40,107,جدة,دفع عند الاستلام,شحن عادي,False
17,2024-07-09,أثاث,أريكة,1,300,300,101,الرياض,بطاقة ائتمان,شحن سريع,True
18,2024-07-09,إلكترونيات,كاميرا,1,250,250,108,مكة,PayPal,شحن عادي,False
19,2024-07-10,ملابس,حذاء رياضي,1,110,110,105,المدينة المنورة,دفع عند الاستلام,شحن سريع,False
20,2024-07-10,كتب,كتاب تاريخ,1,30,30,104,مكة,بطاقة ائتمان,شحن عادي,False
21,2024-07-11,أثاث,مكتب,1,350,350,109,الرياض,PayPal,شحن سريع,True
22,2024-07-11,إلكترونيات,تلفزيون,1,1200,1200,110,المدينة المنورة,دفع عند الاستلام,شحن عادي,False
23,2024-07-12,ملابس,فستان,2,70,140,101,الرياض,بطاقة ائتمان,شحن سريع,False
24,2024-07-12,كتب,قصة قصيرة,2,12,24,106,الرياض,PayPal,شحن عادي,True
25,2024-07-13,أثاث,خزانة,1,400,400,107,جدة,دفع عند الاستلام,شحن سريع,False
26,2024-07-13,إلكترونيات,لاب توب,1,1000,1000,108,مكة,بطاقة ائتمان,شحن عادي,False
27,2024-07-14,ملابس,جاكيت,1,150,150,102,جدة,PayPal,شحن سريع,True
28,2024-07-14,كتب,كتاب علمي,2,25,50,105,المدينة المنورة,دفع عند الاستلام,شحن عادي,False
29,2024-07-15,أثاث,منضدة,1,80,80,103,الدمام,بطاقة ائتمان,شحن سريع,False
30,2024-07-15,إلكترونيات,طابعة,1,180,180,104,مكة,PayPal,شحن عادي,False
31,2024-07-16,ملابس,تي شيرت,3,20,60,109,الرياض,دفع عند الاستلام,شحن سريع,False
32,2024-07-16,كتب,كتاب فلسفة,1,22,22,106,الرياض,بطاقة ائتمان,شحن عادي,True
33,2024-07-17,أثاث,أريكة زاوية,1,700,700,107,جدة,PayPal,شحن سريع,False
34,2024-07-17,إلكترونيات,جهاز لوحي,1,450,450,108,مكة,دفع عند الاستلام,شحن عادي,False
35,2024-07-18,ملابس,تنورة,1,60,60,102,جدة,بطاقة ائتمان,شحن سريع,False
36,2024-07-18,كتب,قاموس,2,15,30,105,المدينة المنورة,PayPal,شحن عادي,False
37,2024-07-19,أثاث,رف كتب,1,120,120,103,الدمام,دفع عند الاستلام,شحن سريع,True
38,2024-07-19,إلكترونيات,سماعة رأس لاسلكية,1,90,90,106,الرياض,بطاقة ائتمان,شحن عادي,False
39,2024-07-20,ملابس,قميص نسائي,2,30,60,101,الرياض,PayPal,شحن سريع,False
40,2024-07-20,كتب,كتاب خيال علمي,1,28,28,107,جدة,دفع عند الاستلام,شحن عادي,False
41,2024-07-21,أثاث,مصباح,1,45,45,108,مكة,بطاقة ائتمان,شحن سريع,False
42,2024-07-21,إلكترونيات,جهاز عرض,1,600,600,109,الرياض,PayPal,شحن عادي,True
43,2024-07-22,ملابس,بنطلون جينز,1,70,70,102,جدة,دفع عند الاستلام,شحن سريع,False
44,2024-07-22,كتب,كتاب تاريخي,2,20,40,104,مكة,بطاقة ائتمان,شحن عادي,False
45,2024-07-23,أثاث,كرسي هزاز,1,250,250,101,الرياض,PayPal,شحن سريع,False
46,2024-07-23,إلكترونيات,لوحة مفاتيح,1,50,50,105,المدينة المنورة,دفع عند الاستلام,شحن عادي,True
47,2024-07-24,ملابس,معطف,1,180,180,103,الدمام,بطاقة ائتمان,شحن سريع,False
48,2024-07-24,كتب,كتاب مغامرات,1,18,18,106,الرياض,PayPal,شحن عادي,False
49,2024-07-25,أثاث,مكتبة,1,380,380,107,جدة,دفع عند الاستلام,شحن سريع,False
50,2024-07-25,إلكترونيات,سماعة بلوتوث,1,60,60,108,مكة,بطاقة ائتمان,شحن عادي,True
51,2024-07-26,ملابس,شورت,2,35,70,109,الرياض,PayPal,شحن سريع,False
52,2024-07-26,كتب,كتاب ديني,1,12,12,102,جدة,دفع عند الاستلام,شحن عادي,False
53,2024-07-27,أثاث,طاولة قهوة,1,100,100,103,الدمام,بطاقة ائتمان,شحن سريع,True
54,2024-07-27,إلكترونيات,محرك أقراص صلبة,1,80,80,105,المدينة المنورة,PayPal,شحن عادي,False
55,2024-07-28,ملابس,فستان سهرة,1,200,200,106,الرياض,دفع عند الاستلام,شحن سريع,False
56,2024-07-28,كتب,كتاب أطفال,2,10,20,107,جدة,بطاقة ائتمان,شحن عادي,False
57,2024-07-29,أثاث,مرآة,1,70,70,109,الرياض,PayPal,شحن سريع,True
58,2024-07-29,إلكترونيات,سماعات أذن,1,40,40,108,مكة,دفع عند الاستلام,شحن عادي,False
59,2024-07-30,ملابس,عباءة,1,120,120,102,جدة,بطاقة ائتمان,شحن سريع,False
60,2024-07-30,كتب,مخطوطة قديمة,1,50,50,105,المدينة المنورة,PayPal,شحن عادي,True
61,2024-07-31,أثاث,ساعة حائط,1,60,60,103,الدمام,دفع عند الاستلام,شحن سريع,False
62,2024-07-31,إلكترونيات,جهاز تحكم,1,35,35,106,الرياض,بطاقة ائتمان,شحن عادي,False
63,2024-08-01,ملابس,حزام,1,30,30,101,الرياض,PayPal,شحن سريع,True
64,2024-08-01,كتب,كتاب فنون,1,35,35,107,جدة,دفع عند الاستلام,شحن عادي,False
65,2024-08-02,أثاث,لوحة جدارية,1,150,150,108,مكة,بطاقة ائتمان,شحن سريع,False
66,2024-08-02,إلكترونيات,قارئ كتب إلكتروني,1,110,110,109,الرياض,PayPal,شحن عادي,True
67,2024-08-03,ملابس,قميص رياضي,2,40,80,102,جدة,دفع عند الاستلام,شحن سريع,False
68,2024-08-03,كتب,كتاب علم نفس,1,25,25,105,المدينة المنورة,بطاقة ائتمان,شحن عادي,False
69,2024-08-04,أثاث,شمعدان,1,40,40,103,الدمام,PayPal,شحن سريع,True
70,2024-08-04,إلكترونيات,جهاز كمبيوتر محمول,1,1100,1100,106,الرياض,دفع عند الاستلام,شحن عادي,False
71,2024-08-05,ملابس,بجامة,2,60,120,101,الرياض,بطاقة ائتمان,شحن سريع,False
72,2024-08-05,كتب,كتاب كوميدي,1,18,18,107,جدة,PayPal,شحن عادي,True
73,2024-08-06,أثاث,طاولة جانبية,1,70,70,108,مكة,دفع عند الاستلام,شحن سريع,False
74,2024-08-06,إلكترونيات,مكبر صوت,1,85,85,109,الرياض,بطاقة ائتمان,شحن عادي,False
75,2024-08-07,ملابس,تنورة جينز,1,80,80,102,جدة,PayPal,شحن سريع,False
76,2024-08-07,كتب,مجلة,3,8,24,105,المدينة المنورة,دفع عند الاستلام,شحن عادي,True
77,2024-08-08,أثاث,وسادة,2,20,40,103,الدمام,بطاقة ائتمان,شحن سريع,False
78,2024-08-08,إلكترونيات,كاميرا ويب,1,70,70,106,الرياض,PayPal,شحن عادي,False
79,2024-08-09,ملابس,بولو,1,55,55,101,الرياض,دفع عند الاستلام,شحن سريع,True
80,2024-08-09,كتب,كتاب لغة,1,20,20,107,جدة,بطاقة ائتمان,شحن عادي,False
81,2024-08-10,أثاث,مقعد,1,110,110,108,مكة,PayPal,شحن سريع,False
82,2024-08-10,إلكترونيات,ماوس لاسلكي,1,30,30,109,الرياض,دفع عند الاستلام,شحن عادي,True
83,2024-08-11,ملابس,قميص بكم طويل,1,65,65,102,جدة,بطاقة ائتمان,شحن سريع,False
84,2024-08-11,كتب,كتاب رحلات,1,18,18,105,المدينة المنورة,PayPal,شحن عادي,False
85,2024-08-12,أثاث,منظم مكتب,1,30,30,103,الدمام,دفع عند الاستلام,شحن سريع,True
86,2024-08-12,إلكترونيات,سماعة بلوتوث رياضية,1,60,60,106,الرياض,بطاقة ائتمان,شحن عادي,False
87,2024-08-13,ملابس,قميص صيفي,1,50,50,101,الرياض,PayPal,شحن سريع,False
88,2024-08-13,كتب,كتاب عن الفضاء,1,25,25,107,جدة,دفع عند الاستلام,شحن عادي,True
89,2024-08-14,أثاث,مكتبة صغيرة,1,220,220,108,مكة,بطاقة ائتمان,شحن سريع,False
90,2024-08-14,إلكترونيات,ميكروفون,1,40,40,109,الرياض,PayPal,شحن عادي,False
91,2024-08-15,ملابس,قميص قطني,2,45,90,102,جدة,دفع عند الاستلام,شحن سريع,True
92,2024-08-15,كتب,كتاب عن الحيوانات,1,15,15,105,المدينة المنورة,بطاقة ائتمان,شحن عادي,False
93,2024-08-16,أثاث,صندوق تخزين,1,50,50,103,الدمام,PayPal,شحن سريع,False
94,2024-08-16,إلكترونيات,ساعة منبه,1,25,25,106,الرياض,دفع عند الاستلام,شحن عادي,True
95,2024-08-17,ملابس,قميص حريري,1,90,90,101,الرياض,بطاقة ائتمان,شحن سريع,False
96,2024-08-17,كتب,كتاب قصص,1,10,10,107,جدة,PayPal,شحن عادي,False
97,2024-08-18,أثاث,حامل نباتات,1,80,80,108,مكة,دفع عند الاستلام,شحن سريع,True
98,2024-08-18,إلكترونيات,سماعات لاسلكية صغيرة,1,30,30,109,الرياض,بطاقة ائتمان,شحن عادي,False
99,2024-08-19,ملابس,قميص رسمي,1,75,75,102,جدة,PayPal,شحن سريع,True
100,2024-08-19,كتب,كتاب طبخ تقليدي,1,18,18,105,المدينة المنورة,دفع عند الاستلام,شحن عادي,False
"""

# إنشاء DataFrame من البيانات النصية
data = StringIO(data)
df = pd.read_csv(data)


# عنوان التطبيق
st.title("تطبيق التنبؤ بالمبيعات")

# وصف التطبيق
st.write("هذا التطبيق يتيح لك تحليل بيانات المبيعات والتنبؤ بالمبيعات المستقبلية باستخدام نموذج ARIMA.")

# معالجة البيانات
df['Order_Date'] = pd.to_datetime(df['Order_Date'])
df['Discount_Applied'] = df['Discount_Applied'].astype(bool)
daily_sales = df.groupby('Order_Date')['Total_Price'].sum()
df_time_series = pd.DataFrame({'Order_Date': daily_sales.index, 'Total_Sales': daily_sales.values})
df_time_series = df_time_series.set_index('Order_Date')
train_size = int(len(df_time_series) * 0.8)
train_data = df_time_series[:train_size]
test_data = df_time_series[train_size:]

# شريط التمرير لتعديل قيم p, d, q
p = st.slider("قيمة p", 0, 10, 5)
d = st.slider("قيمة d", 0, 5, 1)
q = st.slider("قيمة q", 0, 5, 0)


# زر لتشغيل النموذج
if st.button("تشغيل نموذج التنبؤ"):
    # تدريب نموذج ARIMA
    model = ARIMA(train_data['Total_Sales'], order=(p, d, q))
    model_fit = model.fit()

    # التنبؤ بالمبيعات على بيانات الاختبار
    predictions = model_fit.predict(start=len(train_data), end=len(df_time_series)-1)

    # حساب RMSE
    rmse = sqrt(mean_squared_error(test_data['Total_Sales'], predictions))

    # عرض النتائج
    st.write("RMSE:", rmse)
    st.write("قيم التنبؤ:")
    st.write(predictions)

    # رسم بياني للمبيعات الفعلية والمتوقعة
    fig, ax = plt.subplots(figsize=(10, 6))
    ax.plot(test_data.index, test_data['Total_Sales'], label='المبيعات الفعلية', marker='o')
    ax.plot(test_data.index, predictions, label='المبيعات المتوقعة', marker='x')
    ax.set_title('المبيعات الفعلية مقابل المبيعات المتوقعة')
    ax.set_xlabel('تاريخ الطلب')
    ax.set_ylabel('إجمالي المبيعات')
    ax.legend()
    ax.grid(True)
    st.pyplot(fig)
